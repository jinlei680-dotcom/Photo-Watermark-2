# Photo Watermark macOS 应用 PRD（v2.0.0）

## 1. 背景与目标
- 背景：摄影爱好者和内容发布者需要在图片上标注拍摄日期，既保证一致性又提高效率。手动添加水印耗时、易出错，且批量处理困难。
- 目标：提供一款在 macOS 上运行的桌面 GUI 应用，从图片 EXIF 中自动读取拍摄时间（年月日），以文本或图片水印形式叠加到图片，支持样式与位置设置，并输出到规范的新目录。
- 成效指标：
  - 单图从打开到导出 ≤ 30 秒（正常分辨率图片）。
  - 预览设置变更响应 ≤ 100 ms。
  - 处理成功率（含 EXIF 可用与替代策略）≥ 99%。

## 2. 目标用户与场景
- 目标用户：摄影师、博主、自媒体运营者、影像归档人员。
- 使用场景：
  - 快速为单张或少量照片添加拍摄日期水印，用于社交发布或归档。
  - 保留原图不变，将水印版保存到新子目录，便于管理与备份。

## 3. 核心价值主张
- 自动化：自动解析 EXIF 拍摄时间，减少人工输入。
- 一致性：统一的日期格式与位置样式，提升观感与专业性。
- 安全性：不覆盖原图，输出至独立子目录；不外传数据。

## 4. 产品范围（In/Out of Scope）
- In Scope：
  - 单张图片加载与原图预览（未加水印）。
  - EXIF 读取与日期解析（优先 DateTimeOriginal，回退 CreateDate/ModifyDate）。
  - 日期格式统一为 `YYYY-MM-DD`。
  - 水印类型：文字 / 图片（二选一，互斥切换）。
  - 文字水印样式：字体大小、颜色、字体族、透明度；位置：左上/居中/右下；边距设置；基础阴影与描边（v2.0.0）。
  - 图片水印样式：选择图片源、透明度；缩放方式（百分比 0.01%–100%；或指定目标尺寸）。位置与边距同文字（v2.0.0）。
  - 实时预览；与导出使用同一绘制逻辑确保一致性。
  - 保存：在原目录下新建 `原目录名_watermark` 子目录，文件名追加 `_watermark`。
- Out of Scope（v2.0.0）：
  - 批量处理、目录级处理（后续版本考虑）。
  - 多行富文本、复杂描边样式（后续版本考虑）。
  - 多语言 UI（当前仅中文）。

## 5. 功能需求
### 5.1 图片加载与预览
- 支持通过“打开文件”对话框或拖拽加载单张图片文件。
- 支持格式：JPEG/JPG；PNG（无 EXIF 时提供替代方案）；HEIC（视系统支持）。
- 在主界面显示原图预览（未加水印），预览缩放适配窗口，不改变原始像素。

### 5.2 EXIF 读取与日期解析
- 优先读取 `DateTimeOriginal`，缺失时依次尝试 `CreateDate`、`ModifyDate`。
- 解析时间，格式化为 `YYYY-MM-DD`。
- 若无有效日期：提示用户，提供两种替代方案：
  1) 手动输入日期；
  2) 使用文件创建时间（系统文件属性）。

### 5.3 水印样式与位置设置
- 类型选择：分段控制切换“文字 / 图片”，互斥生效。
- 文字：字体大小（默认 24，范围 12–96）、颜色与透明度、字体族、位置、边距；基础阴影（偏移 X/Y、半径、颜色与透明度）与描边（宽度/颜色）。
- 图片：选择图片、不透明度；缩放（百分比 0.01%–100%，默认 50%；或指定宽/高）；位置与边距设置。
- 对齐规则：文本与图片均基于锚点布局，避免裁剪到边界外。

### 5.4 预览与一致性
- 设置变更实时更新水印预览，不修改原始文件。
- 预览与导出共用同一布局与度量逻辑（`WatermarkLayout`），确保所见即所得。

### 5.5 保存与输出策略
- 输出目录：在原图片所在目录创建子目录 `原目录名_watermark`（原目录名 + `_watermark`）。
- 文件命名：在原文件名基础上追加 `_watermark`，如 `IMG_0001.jpg` → `IMG_0001_watermark.jpg`。
- 输出格式：与输入一致（JPEG 按质量 90 默认；PNG 无损）。
- 元数据：尽量保留原图 EXIF（若技术受限至少保留基本信息）；提供设置开关以控制是否尽可能保留。

## 6. 交互与用户流程
### 6.1 主流程（单图）
1. 选择或拖拽图片文件；
2. 显示原图预览；
3. 自动解析 EXIF 日期并填充水印文本（只读）；
4. 用户调整字体大小、颜色、位置、边距；
5. 预览实时更新；
6. 点击保存，生成输出文件至 `原目录名_watermark` 子目录；
7. 状态栏提示保存成功与输出路径。

### 6.2 异常与分支
- 无 EXIF 日期：弹窗提示并提供“手动选择日期”或“使用文件创建时间”。
- 保存失败（权限/空间/路径无效）：弹窗提示详细错误，保留重试入口。
- 非支持格式：提示不支持并引导使用 JPEG/PNG。

## 7. 信息架构与界面
- 主窗口布局：
  - 顶部工具栏：`打开`、`保存`、`设置`、`帮助`。
  - 左侧/中间区域：预览区（原图叠加水印预览）。
  - 右侧面板：水印文本（只读）、字体大小、颜色选择器、位置选择（单选）、边距设置。
  - 底部状态栏：EXIF 解析状态、输出目录、错误反馈。

## 8. 文案与提示
- EXIF 解析成功：`已读取拍摄日期：YYYY-MM-DD`。
- EXIF 不可用：`未找到拍摄日期，可选择手动输入或使用文件创建时间`。
- 保存成功：`已保存至：<输出路径>`。
- 保存失败：按具体原因给出可读提示（权限/空间/路径问题）。

## 9. 性能与稳定性要求
- 预览更新 ≤ 100 ms；内存管理对高分辨率图片友好，避免卡顿或崩溃。
- 对异常元数据、超长文件名、只读目录进行防护处理。

## 10. 兼容性与限制
- 平台：macOS 12.0 及以上。
- 格式：JPEG/JPG 最佳；PNG 通常无 EXIF；HEIC 取决于系统与库支持。
- 字体渲染：使用系统字体；避免第三方字体导致兼容问题。

## 11. 隐私与安全
- 不外传图片或元数据；不写入除输出文件外的任何用户数据。
- 日志仅用于本地开发调试，默认不上传。

## 12. 配置项（默认值）
- 字体大小：24；颜色：`#FFFFFF`；位置：`右下角`；边距：16 px；
- JPEG 输出质量：90；是否尽量保留 EXIF：开启。

## 13. 验收标准（UAT）
- 在 macOS 12/13/14 上：
  - 给定含 `DateTimeOriginal` 的 JPEG：显示原图、生成 `YYYY-MM-DD` 水印、样式位置准确、保存至子目录、文件名带 `_watermark`。
  - 给定无 EXIF 的 PNG：提示替代方案，选择文件创建时间后成功生成并保存。
  - 超大分辨率图片：预览不崩溃，保存成功。

## 14. 发布与里程碑（更新）
- v1.x：体验打磨、位置/边距设置、基础阴影/描边（文字）。
- v2.0.0：
  - 新增：水印类型分段控制（文字/图片互斥）。
  - 新增：图片水印缩放（百分比 0.01%–100%；或指定尺寸）。
  - 优化：预览与导出统一逻辑，边界与最小比例更健壮。
  - 修复：预览按钮可用状态与类型切换引发的异常。

## 15. 风险与应对
- EXIF 缺失或字段不规范：提供替代策略与弹窗提示。
- HEIC/RAW 兼容：明确限制与提示，建议先转为 JPEG。
- 权限与磁盘空间：保存前检查并提示。

## 16. 跟踪指标
- 使用次数、成功导出次数、失败原因分布（本地统计，用户可选开启）。
